<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Title -->
    <title>Tortuga Chain</title>

    <!-- Bootstrap -->
    <link href="Content/bootstrap.min.css" rel="stylesheet">
    <link href="Content/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Prism -->
    <script src="Scripts/prism.js"></script>
    <link href="Content/prism.css" rel="stylesheet" />

    <!-- Projbook -->
    <link href="Content/projbook.css" rel="stylesheet">
</head>
<body role="document">
    <div class="container">
        <div class="row">

            <!--Nav Bar -->
            <nav class="col-md-3 bs-docs-sidebar">
                <ul id="sidebar" class="nav nav-stacked fixed hidden-xs hidden-sm">
                    <li>
                        <a href="#PageIntroductionmd">Quick Start</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageIntroductionmd-tortuga-chain">Tortuga Chain</a></li>
                            <li><a href="#PageIntroductionmd-getting-started">Getting Started</a></li>
                            <li><a href="#PageIntroductionmd-connection-management">Connection Management</a></li>
                            <li><a href="#PageIntroductionmd-transactions">Transactions</a></li>
                            <li><a href="#PageIntroductionmd-command-chains">Command Chains</a></li>
                            <li><a href="#PageIntroductionmd-commands">Commands</a></li>
                            <li><a href="#PageIntroductionmd-materializers">Materializers</a></li>
                            <li><a href="#PageIntroductionmd-crud-operations">CRUD Operations</a></li>
                            <li><a href="#PageIntroductionmd-create">Create</a></li>
                            <li><a href="#PageIntroductionmd-read">Read</a></li>
                            <li><a href="#PageIntroductionmd-update">Update</a></li>
                            <li><a href="#PageIntroductionmd-delete">Delete</a></li>
                            <li><a href="#PageIntroductionmd-appenders">Appenders</a></li>
                            <li><a href="#PageIntroductionmd-execution-modes">Execution Modes</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageDataSourcesmd">Data Sources</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageDataSourcesmd-data-sources">Data Sources</a></li>
                            <li><a href="#PageDataSourcesmd-basic-configuration">Basic Configuration</a></li>
                            <li><a href="#PageDataSourcesmd-advanced-configuration">Advanced Configuration</a></li>
                            <li><a href="#PageDataSourcesmd-data-source-classifications">Data Source Classifications</a></li>
                            <li><a href="#PageDataSourcesmd-iclass1datasource">IClass1DataSource</a></li>
                            <li><a href="#PageDataSourcesmd-iclass2datasource">IClass2DataSource</a></li>
                            <li><a href="#PageDataSourcesmd-internals">Internals</a></li>
                            <li><a href="#PageDataSourcesmd-command-execution">Command Execution</a></li>
                            <li><a href="#PageDataSourcesmd-metadata">Metadata</a></li>
                            <li><a href="#PageDataSourcesmd-extension-data">Extension Data</a></li>
                            <li><a href="#PageDataSourcesmd-data-caching">Data Caching</a></li>
                            <li><a href="#PageDataSourcesmd-universal-windows-platform-limitations">Universal Windows Platform Limitations</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersmd">Command Builders</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersmd-command-builders">Command Builders</a></li>
                            <li><a href="#PageCommandBuildersmd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersmd-metadata-consumption">Metadata Consumption</a></li>
                            <li><a href="#PageCommandBuildersmd-execution">Execution</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersmd">Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersmd-materializers">Materializers</a></li>
                            <li><a href="#PageMaterializersmd-sql">Sql</a></li>
                            <li><a href="#PageMaterializersmd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersmd-limitations">Limitations</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageAppendersmd">Appenders</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageAppendersmd-appenders">Appenders</a></li>
                            <li><a href="#PageAppendersmd-internals">Internals</a></li>
                            <li><a href="#PageAppendersmd-before-execution">Before execution</a></li>
                            <li><a href="#PageAppendersmd-after-execution">After execution</a></li>
                            <li><a href="#PageAppendersmd-instead-of-execution">Instead of execution</a></li>
                            <li><a href="#PageAppendersmd-creating-an-appender">Creating an Appender</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersFrommd">From Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersFrommd-from-command-builder">From Command Builder</a></li>
                            <li><a href="#PageCommandBuildersFrommd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersFrommd-sorting">Sorting</a></li>
                            <li><a href="#PageCommandBuildersFrommd-limits">Limits</a></li>
                            <li><a href="#PageCommandBuildersFrommd-filters">Filters</a></li>
                            <li><a href="#PageCommandBuildersFrommd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersFrommd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersFrommd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersFrommd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersByKeymd">By Key Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersByKeymd-getbykey--updatebykey--and-deletebykey-command-builders">GetByKey, UpdateByKey, and DeleteByKey Command Builders</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-arguments--updatebykey-only">Arguments, UpdateByKey Only</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-sorting">Sorting</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersByKeymd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersInsertmd">Insert Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersInsertmd-insert-command-builder">Insert Command Builder</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-sql-server">SQL Server</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-sqlite">SQLite</a></li>
                            <li><a href="#PageCommandBuildersInsertmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersUpdatemd">Update Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersUpdatemd-update-command-builder">Update Command Builder</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-sql-server">SQL Server</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-sqlite">SQLite</a></li>
                            <li><a href="#PageCommandBuildersUpdatemd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersUpsertmd">Upsert Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersUpsertmd-upsert-command-builder">Upsert Command Builder</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-sql-server">SQL Server</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-sqlite">SQLite</a></li>
                            <li><a href="#PageCommandBuildersUpsertmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersDeletemd">Delete Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersDeletemd-delete-command-builder">Delete Command Builder</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-sql-server">SQL Server</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-sqlite">SQLite</a></li>
                            <li><a href="#PageCommandBuildersDeletemd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersSQLmd">SQL Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersSQLmd-sql-command-builder">SQL Command Builder</a></li>
                            <li><a href="#PageCommandBuildersSQLmd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersSQLmd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersSQLmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersSQLmd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersSQLmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersTableFunctionmd">Table Function Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersTableFunctionmd-table-function-command-builder">Table Function Command Builder</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-function-arguments">Function Arguments</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-sorting">Sorting</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-limits">Limits</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-filters">Filters</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-limitations">Limitations</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersTableFunctionmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageCommandBuildersProceduremd">Procedure Command Builder</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageCommandBuildersProceduremd-procedure-command-builder">Procedure Command Builder</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-arguments">Arguments</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-sql-server">SQL Server</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-postgresql">PostgreSQL</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-internals">Internals</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-postgresql-2">PostgreSQL</a></li>
                            <li><a href="#PageCommandBuildersProceduremd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersNonQuerymd">Non-Query Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersNonQuerymd-non-query-materializers">Non-Query Materializers</a></li>
                            <li><a href="#PageMaterializersNonQuerymd-limitations">Limitations</a></li>
                            <li><a href="#PageMaterializersNonQuerymd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersNonQuerymd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersNonQuerymd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersScalarmd">Scalar Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersScalarmd-scalar-materializers">Scalar Materializers</a></li>
                            <li><a href="#PageMaterializersScalarmd-options">Options</a></li>
                            <li><a href="#PageMaterializersScalarmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersScalarmd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersScalarmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersListmd">List Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersListmd-list-materializers">List Materializers</a></li>
                            <li><a href="#PageMaterializersListmd-options">Options</a></li>
                            <li><a href="#PageMaterializersListmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersListmd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersListmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersObjectmd">Object/Collection Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersObjectmd-object-collection-materializers">Object/Collection Materializers</a></li>
                            <li><a href="#PageMaterializersObjectmd-options">Options</a></li>
                            <li><a href="#PageMaterializersObjectmd-capabilities">Capabilities</a></li>
                            <li><a href="#PageMaterializersObjectmd-non-default-constructors">Non-default Constructors</a></li>
                            <li><a href="#PageMaterializersObjectmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersObjectmd-limitations">Limitations</a></li>
                            <li><a href="#PageMaterializersObjectmd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersObjectmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersCompiledmd">Compiled Object/Collection Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersCompiledmd-compiled-object-collection-materializers">Compiled Object/Collection Materializers</a></li>
                            <li><a href="#PageMaterializersCompiledmd-options">Options</a></li>
                            <li><a href="#PageMaterializersCompiledmd-capabilities">Capabilities</a></li>
                            <li><a href="#PageMaterializersCompiledmd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersCompiledmd-limitations">Limitations</a></li>
                            <li><a href="#PageMaterializersCompiledmd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersCompiledmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersDataTablemd">DataRow/Table/Set Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersDataTablemd-datarow--datatable--and-dataset-materializers">DataRow, DataTable, and DataSet Materializers</a></li>
                            <li><a href="#PageMaterializersDataTablemd-options">Options</a></li>
                            <li><a href="#PageMaterializersDataTablemd-sql-generation">SQL Generation</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageMaterializersTablemd">Row, Table, and TableSet Materializers</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageMaterializersTablemd-row--table--and-tableset-materializers">Row, Table, and TableSet Materializers</a></li>
                            <li><a href="#PageMaterializersTablemd-options">Options</a></li>
                            <li><a href="#PageMaterializersTablemd-sql-generation">SQL Generation</a></li>
                            <li><a href="#PageMaterializersTablemd-internals">Internals</a></li>
                            <li><a href="#PageMaterializersTablemd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageAppendersCachingmd">Caching Appenders</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageAppendersCachingmd-caching-appenders">Caching Appenders</a></li>
                            <li><a href="#PageAppendersCachingmd-cache-keys">Cache Keys</a></li>
                            <li><a href="#PageAppendersCachingmd-example-of-a-caching-repository">Example of a Caching Repository</a></li>
                            <li><a href="#PageAppendersCachingmd-internals">Internals</a></li>
                            <li><a href="#PageAppendersCachingmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageAppendersTracingmd">Tracing Appenders</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageAppendersTracingmd-tracing-appenders">Tracing Appenders</a></li>
                            <li><a href="#PageAppendersTracingmd-arguments">Arguments</a></li>
                            <li><a href="#PageAppendersTracingmd-internals">Internals</a></li>
                            <li><a href="#PageAppendersTracingmd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageAppendersSqlDependencymd">Change Notification Appenders</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageAppendersSqlDependencymd-change-notification-appenders">Change Notification Appenders</a></li>
                            <li><a href="#PageAppendersSqlDependencymd-arguments">Arguments</a></li>
                            <li><a href="#PageAppendersSqlDependencymd-internals">Internals</a></li>
                            <li><a href="#PageAppendersSqlDependencymd-roadmap">Roadmap</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageAuditRulesmd">Audit Rules</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageAuditRulesmd-audit-rules">Audit Rules</a></li>
                            <li><a href="#PageAuditRulesmd-validation">Validation</a></li>
                            <li><a href="#PageAuditRulesmd-triggering-validation">Triggering Validation</a></li>
                            <li><a href="#PageAuditRulesmd-custom-validation">Custom Validation</a></li>
                            <li><a href="#PageAuditRulesmd-created-by-updated-by-support">Created By/Updated By Support</a></li>
                            <li><a href="#PageAuditRulesmd-created-date-updated-date-support">Created Date/Updated Date Support</a></li>
                            <li><a href="#PageAuditRulesmd-soft-delete-support">Soft Delete Support</a></li>
                            <li><a href="#PageAuditRulesmd-transactions">Transactions</a></li>
                            <li><a href="#PageAuditRulesmd-dependency-injection">Dependency Injection</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageRestrictedColumnsmd">Restricted Columns</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageRestrictedColumnsmd-restricted-columns">Restricted Columns</a></li>
                            <li><a href="#PageRestrictedColumnsmd-usage-notes">Usage Notes</a></li>
                            <li><a href="#PageRestrictedColumnsmd-implementation">Implementation</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageTransactionsmd">Transactions</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageTransactionsmd-transactions">Transactions</a></li>
                            <li><a href="#PageTransactionsmd-attaching-to-active-connections-and-transactions">Attaching to Active Connections and Transactions</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageOtherEntityFrameworkmd">Entity Framework Integration</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageOtherEntityFrameworkmd-entity-framework-integration">Entity Framework Integration</a></li>
                            <li><a href="#PageOtherEntityFrameworkmd-chainforentityframework-class">ChainForEntityFramework Class</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#PageOtherNHibernatemd">NHibernate Integration</a>
                        <ul class="nav nav-stacked">
                            <li><a href="#PageOtherNHibernatemd-nhibernate-integration">NHibernate Integration</a></li>
                            <li><a href="#PageOtherNHibernatemd-chainfornhibernate-class">ChainForNHibernate Class</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>

            <!--Main Content -->
            <div class="col-md-9">
                <section id="PageIntroductionmd">
                    <!--<div class="page-header">
                        <h1>Quick Start</h1>
                    </div>-->
                    
                    <div id="PageIntroductionmd-tortuga-chain">
                        <h2>Tortuga Chain</h2>
<p>A Fluent ORM for .NET</p>

                    </div>
                    <div id="PageIntroductionmd-getting-started">
                        <h3>Getting Started</h3>
<p>To get started with Chain, you need to create a data source. This can be done using a connection string or a <code>SqlConnectionStringBuilder</code>. Optionally, you can also name your data source. (This has no functional effect, but does assist in logging.)</p>
<pre><code class="language-csharp">dataSource = new Tortuga.Chain.SqlServerDataSource(&quot;Adventure DB&quot;, &quot;Server=.;Database=AdventureWorks2014;Trusted_Connection=True;&quot;);
</code></pre>
<p>Or from your app.config file:</p>
<pre><code class="language-csharp">dataSource = Tortuga.Chain.SqlServerDataSource.CreateFromConfig(&quot;AdventureDB&quot;);
</code></pre>
<p>Your data source should be treated as a singleton object; you only need one per unique connection string. This is important because your data source will cache information about your database.</p>
<p>We recommend calling dataSource.Test() when your application starts up. This verifies that you can actually connect to the database.</p>

                    </div>
                    <div id="PageIntroductionmd-connection-management">
                        <h3>Connection Management</h3>
<p>A major difference between Chain and other ORMs is that you don't need to manage connections or data contexts. A Chain data source is designed to be completely thread safe and will handle connection lifetime for you automatically.</p>

                    </div>
                    <div id="PageIntroductionmd-transactions">
                        <h3>Transactions</h3>
<p>Transactions still need to contained within a <code>using</code> statement and explicitly committed. You can create one by calling <code>dataSource.BeginTransaction()</code>.</p>

                    </div>
                    <div id="PageIntroductionmd-command-chains">
                        <h3>Command Chains</h3>
<p>Command chains are the primary way of working with Tortuga. Each link in the chain is used to inform the previous link about what actions are desired. Here is a basic example:</p>
<pre><code class="language-csharp">dataSource.Procedure(&quot;uspGetEmployeeManagers&quot;, new {@BusinessEntityID = 100}).ToCollection&lt;Manager&gt;().Execute();
</code></pre>
<p>Breaking this down, we have:</p>
<ul>
<li>The data source</li>
<li>The command being performed</li>
<li>How the results of the command should be returned</li>
<li>If the operation should be executed synchronously or asynchronously</li>
</ul>

                    </div>
                    <div id="PageIntroductionmd-commands">
                        <h4>Commands</h4>
<p>The list of available commands depends on the data source. Most data sources support</p>
<ul>
<li>Raw sql</li>
<li>Table/View queries</li>
<li>Insert, Update, and Delete operations (some also include 'upserts')</li>
</ul>
<p>Advanced ones may also include</p>
<ul>
<li>Stored procedures and/or Table Value Functions</li>
<li>Batch insert, a.k.a. bulk copy</li>
</ul>
<p>Most commands accept a parameter object. The parameter object can be a normal class, a dictionary of type <code>IDictionary&lt;string, object&gt;</code>, or a list of appropriate DbParameter objects.</p>
<p>Chain command builders honor .NET's <code>NotMapped</code> and <code>Column</code> attributes.</p>

                    </div>
                    <div id="PageIntroductionmd-materializers">
                        <h4>Materializers</h4>
<p>Materializers are an optional link, you only need them if you want something back from the database.</p>
<p>An interesting feature of the materializer is that it participates in SQL generation. For example, if you use the <code>ToObject&lt;T&gt;</code> or <code>ToCollection&lt;T&gt;</code> materializer, then it will read the list of properties on class T. That list of properties will be used to generate the SELECT clause, ensuring that you don't pull back more information than you actually need. This in turn means that indexes are used more efficiently and performance is improved.</p>
<p>Materializers call into several categories:</p>
<ul>
<li>Scalar: <code>ToInt</code>, <code>ToIntOrNull</code>, <code>ToString</code></li>
<li>Row: <code>ToRow</code>, <code>ToDataRow</code>, <code>ToObject</code></li>
<li>Table: <code>ToTable</code>, <code>ToDataTable</code>, <code>ToCollection</code></li>
<li>Multiple Tables: <code>ToTableSet</code>, <code>ToDataSet</code></li>
</ul>
<p>For better performance, you can use the compiled materializer extension:</p>
<ul>
<li>Row: <code>.Compile().ToObject&lt;TObject&gt;()</code></li>
<li>Table: <code>.Compile().ToCollection&lt;TObject&gt;()</code>, <code>.Compile().ToCollection&lt;TList, TObject&gt;()</code></li>
</ul>
<p>This requires the <code>Tortuga.Chain.CompiledMaterializers</code> package, which includes CS-Script as a dependency.</p>

                    </div>
                    <div id="PageIntroductionmd-crud-operations">
                        <h4>CRUD Operations</h4>
<p>By combining commands and materializers, you can perform all of the basic CRUD operations. Here are some examples.</p>

                    </div>
                    <div id="PageIntroductionmd-create">
                        <h5>Create</h5>
<pre><code class="language-csharp">var vehicleKey = dataSource.Insert(&quot;Vehicle&quot;, new { VehicleID = &quot;65476XC54E&quot;, Make = &quot;Cadillac&quot;, Model = &quot;Fleetwood Series 60&quot;, Year = 1955 }).ToInt32().Execute();
</code></pre>

                    </div>
                    <div id="PageIntroductionmd-read">
                        <h5>Read</h5>
<pre><code class="language-csharp">var car = dataSource.GetById(&quot;Vehicle&quot;, vehicleKey).ToObject&lt;Vehicle&gt;().Execute();
var cars = dataSource.From(&quot;Vehicle&quot;, new {Make = &quot;Cadillac&quot;).ToCollection&lt;Vehicle&gt;().Execute();
</code></pre>

                    </div>
                    <div id="PageIntroductionmd-update">
                        <h5>Update</h5>
<pre><code class="language-csharp">dataSource.Update(&quot;Vehicle&quot;, new { VehicleKey = vehicleKey, Year = 1957 }).Execute();
</code></pre>

                    </div>
                    <div id="PageIntroductionmd-delete">
                        <h5>Delete</h5>
<pre><code class="language-csharp">dataSource.Delete(&quot;Vehicle&quot;, new { VehicleKey = vehicleKey }).Execute();
</code></pre>

                    </div>
                    <div id="PageIntroductionmd-appenders">
                        <h4>Appenders</h4>
<p>Appenders are links that can change the rules before, during, or after execution.  An appender can be added after a materializer or another appender.</p>
<p>Caching appenders include:</p>
<ul>
<li><code>Cache</code>: Writes to the cache, overwriting any previous value. (Use with Update and Procedure operations.)</li>
<li><code>ReadOrCache</code>: If it can read from the cache, the database operation is aborted. Otherwise the value is cached.</li>
<li><code>CacheAllItems</code>: Cache each item in the result list individually. Useful when using a GetAll style operation.</li>
<li><code>InvalidateCache</code>: Removes a cache entry. Use with any operation that modifies a record.</li>
</ul>
<p>Here is an example of CRUD operations using caching.</p>
<pre><code class="language-csharp">var car = dataSource.GetById(&quot;Vehicle&quot;, vehicleKey).ToObject&lt;Vehicle&gt;().ReadOrCache(&quot;Vehicle &quot; + vehicleKey).Execute();
car = dataSource.Update(&quot;Vehicle&quot;, new { VehicleKey = vehicleKey, Year = 1957 }).ToObject&lt;Vehicle&gt;().Cache(&quot;Vehicle &quot; + vehicleKey).Execute();
dataSource.Delete(&quot;Vehicle&quot;, new { VehicleKey = vehicleKey }).InvalidateCache(&quot;Vehicle &quot; + vehicleKey.Execute();
</code></pre>
<p>If using SQL Server, you can also use <code>WithChangeNotification</code>. This uses SQL Dependency to listen for changes to the table(s) you queried.</p>
<p>When debugging applications, it is often nice to dump the SQL somewhere. This is where the tracing appenders come into play.</p>
<ul>
<li><code>WithTracing</code>: Writes to an arbitrary TextWriter style stream.</li>
<li><code>WithTracingToConsole</code>: Writes to the Console window</li>
<li><code>WithTracingToDebug</code>: Writes to the Debug window</li>
</ul>
<p>You can also override DBCommand settings such as the command timeout. For example:</p>
<pre><code class="language-csharp">ds.Procedure(&quot;ExpensiveReport&quot;).ToDataSet().SetTimeout(TimeSpan.FromHours(3)).Execute()
</code></pre>

                    </div>
                    <div id="PageIntroductionmd-execution-modes">
                        <h4>Execution Modes</h4>
<p>The final link in any chain is the execution mode. There are two basic options:</p>
<ul>
<li><code>Execute()</code></li>
<li><code>ExecuteAsync()</code></li>
</ul>
<p>Both options accept a <code>state</code> parameter. This has no direct effect, but can be used to facilitate logging. <code>ExecuteAsync</code> also accepts an optional cancellation token.</p>

                    </div>
                </section>
                <section id="PageDataSourcesmd">
                    <!--<div class="page-header">
                        <h1>Data Sources</h1>
                    </div>-->
                    
                    <div id="PageDataSourcesmd-data-sources">
                        <h2>Data Sources</h2>
<p>At the beginning of every chain is a <code>DataSource</code>. A normal data source represents an abstract connection to the database. The key word here is 'abstract'; this is not an actual connection but rather all of the information needed to create and manage one.</p>
<p>Normally an application will only have one instance of a data source per connection string. This is important, as the data source needs to cache information about your database and application.</p>

                    </div>
                    <div id="PageDataSourcesmd-basic-configuration">
                        <h3>Basic Configuration</h3>
<p>Most of the time, all of the configuration needed to create a data source can be found with a normal ADO.NET style connection string. The connection string can be passed to the constructor as a <code>String</code> or the appropriate subclass of <code>DbConnectionStringBuilder</code>. Optionally you can also provide a name for the data source. The name has no effect, but may be useful for logging.</p>
<p>On the .NET Framework, data sources also provide a factory method called <code>CreateFromConfig</code> for reading the connection string from the app.config file. (This is not available on UWP.)</p>

                    </div>
                    <div id="PageDataSourcesmd-advanced-configuration">
                        <h4>Advanced Configuration</h4>
<p>For some databases, you may override connection settings beyond those offered by the connection string. For example, for SQL Server you can alter <code>dataSource.Settings.ArithAbort</code> and <code>dataSource.Settings.XactAbort</code>. These overrides are applied each time a connection is opened by the data source.</p>
<p>The <code>Settings</code> object is database specific and will not necessarily be available for all types of data sources.</p>

                    </div>
                    <div id="PageDataSourcesmd-data-source-classifications">
                        <h3>Data Source Classifications</h3>
<p>Chain is primarily designed to take advantage of the capabilities of a database. Rather than catering to the &quot;lowest common denominator&quot; like many ORMs, we'd rather give you full access to everything your database is capable of supporting.</p>
<p>However, we realize that some projects actually do need database portability. For those project we offer a set of data source classifications, which are expressed in terms of interfaces.</p>

                    </div>
                    <div id="PageDataSourcesmd-iclass1datasource">
                        <h4>IClass1DataSource</h4>
<p>A class 1 data source provides the necessary functionality to support a repository pattern using CRUD style operations. Briefly these include:</p>
<ul>
<li>Database metadata (tables, views, columns, etc.)</li>
<li>From</li>
<li>Insert: Single row inserts</li>
<li>Update: Single row updates</li>
<li>Upsert: Automatic insert or update as appropriate</li>
<li>Delete: Single row deletes</li>
<li>Sql: Raw SQL statements with optional parameters.</li>
</ul>
<p>Separate pages will be offered to document each of these operations.</p>

                    </div>
                    <div id="PageDataSourcesmd-iclass2datasource">
                        <h4>IClass2DataSource</h4>
<p>We are still identifying the minimum necessary features to classify something as class 2 data source. The current thought is that it would have to support the following operations:</p>
<ul>
<li>Procedure: Execute a stored procedure</li>
<li>Bulk Insert: For quickly loading a lot of data [Milestone 1.1]</li>
<li>Function: Query from table-valued functions [Milestone 1.2]</li>
</ul>

                    </div>
                    <div id="PageDataSourcesmd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageDataSourcesmd-command-execution">
                        <h4>Command Execution</h4>
<p>The database contains an Execute and ExecuteCore method for processing execution tokens. Within these methods the connection is opened and the DBCommand is created. Materializers provide a call-back through which the command is executed and the results are processed.</p>
<p>Commands are executed by the materializer callback because neither the execution token nor the data source know whether you need <code>ExecuteNonQuery</code>, <code>ExecuteScalar</code>, or <code>ExecuteReader</code>. This also gives the materializer the option to set execution mode flags such as <code>Sequential</code>.</p>

                    </div>
                    <div id="PageDataSourcesmd-metadata">
                        <h4>Metadata</h4>
<p>The data source contains metadata about database such as a list of tables and views. While available to the application, this information is primary used by the command builders to generate SQL.</p>
<p>In order to achieve reasonable performance, the data source caches the metadata. This means that the data source can become out of sync with the database if the schema changes while the application is running. Currently there is no way to &quot;reset&quot; the cache, so if that happens you'll need to create a new instance of the data source.</p>

                    </div>
                    <div id="PageDataSourcesmd-extension-data">
                        <h4>Extension Data</h4>
<p>Some Chain extensions such as compiled materializers need to cache data source specific information. For these, there is the <code>DataSource.GetExtensionData</code> method. Each extension should only store one object here. Any additional information should hang off that object rather than creating multiple keys.</p>

                    </div>
                    <div id="PageDataSourcesmd-data-caching">
                        <h4>Data Caching</h4>
<p>Data caching is performed through the data source object. Originally the intention was to use the <code>System.Runtime.Caching</code> framework, which would have allowed developers to plug in any caching framework they want. However, it turns out that framework has some design flaws and we're going to need to create our own caching interface and matching adapters.</p>
<p>In the meantime, we'll be using .NET's MemoryCache but are not exposing it. That way there won't be a breaking change once we settle on a caching interface.</p>

                    </div>
                    <div id="PageDataSourcesmd-universal-windows-platform-limitations">
                        <h4>Universal Windows Platform Limitations</h4>
<p>UWP does not support the <code>System.Runtime.Caching</code> framework, which in turn means that Chain for UWP doesn't support it either. Again, this will change once we develop our own caching interface and start writing adapters for the more popular caching libraries and servers.</p>

                    </div>
                </section>
                <section id="PageCommandBuildersmd">
                    <!--<div class="page-header">
                        <h1>Command Builders</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersmd-command-builders">
                        <h2>Command Builders</h2>
<p>A command builder is used to generate SQL for a specific type of operation. SQL generation does not occur immediately, but rather waits until you've selected a materializer and, optionally, appenders.</p>
<p>The reason for the delay is that materializers often change the way the SQL is generated. For example, when performing an Insert operation you have the option of getting back nothing, just the newly inserted primary key, or an entire object with any defaulted/calculated columns.</p>
<p>Since each command builder works differently, we can't really go into details here.</p>

                    </div>
                    <div id="PageCommandBuildersmd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageCommandBuildersmd-metadata-consumption">
                        <h4>Metadata Consumption</h4>
<p>When a command builder is created, it may immediately fetch metadata from the data source. This means that you could potentially see blocking operation and/or database error before you actually try to execute a Chain.</p>
<p>In practice this shouldn't be a problem, as it should only occur the first time a given table/view is referenced. But if you are concerned, you can call <code>dataSource.Metadata.PreloadTables</code> and <code>PreloadViews</code> during startup. The time it takes to run these operations varies with the size of the database schema, so it may negatively impact performance.</p>

                    </div>
                    <div id="PageCommandBuildersmd-execution">
                        <h4>Execution</h4>
<p>When a chain is executed, the materializer calls <code>Prepare</code> on the command builder, which in turn creates an execution token. This token contains the SQL statement and parameters needed to build and execute a <code>System.Data.Common.DBCommand</code> object. The materializer and appenders can further modify the execution token from here, but the command builder is no longer in the process.</p>

                    </div>
                </section>
                <section id="PageMaterializersmd">
                    <!--<div class="page-header">
                        <h1>Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersmd-materializers">
                        <h2>Materializers</h2>
<p>Materializers represent the <code>SELECT</code> part of the SQL generation process. They can be used to request the result of an operation be formatted as a scalar value, a list, an object, a collection, or a traditional <code>DataTable</code>. The base classes are public so that additional materializers can be created in the same fashion as the built-in ones.</p>
<p>Materializers are always linked directly to command builders. They are usually expressed as <code>.ToXxx</code> where Xxx is the type of result desired. There is also a special <code>AsNonQuery()</code> command builder for when you don't need anything back (e.g. insert/update operations). Many materializers allow you to set options that further refine their behavior.</p>
<p>Generally speaking, the classes that implement materializers are non-public. Instead you get back an <code>ILink</code> or <code>ILink&lt;T&gt;</code> wrapper. This is necessary as the concrete implementation of the materializer may change depending on the options you select. It is best to think of an <code>ILink</code> in the same way you think of an <code>IEnumerable</code> in a LINQ expression.</p>

                    </div>
                    <div id="PageMaterializersmd-sql">
                        <h3>Sql</h3>
<p>All materializers offer a <code>Sql</code> method. This returns the SQL that would have been executed.</p>
<p>Note that this is not the only way to access the SQL being generated and is primarily meant to be used when debugging. For other situations, it is typical to access the SQL via the logging events and with a Trace appender.</p>

                    </div>
                    <div id="PageMaterializersmd-internals">
                        <h3>Internals</h3>
<p>When a materializer is executed, it first calls <code>Prepare</code> on the command builder it is linked to in order to generate an execution token. Immediately afterwards, it fires an ExecutionTokenPrepared event that appenders can listen for. (If you request the SQL from a materializer, only this step is performed.)</p>
<p>Next, the materializer calls Execute (or ExecuteAsync) on the execution token, passing in a callback. This callback is given a <code>DBCommand</code> object on which the materializer can call <code>ExecuteNonQuery</code>, <code>ExecuteScalar</code>, or <code>ExecuteReader</code> as appropriate.</p>
<p>The callback is expected to return an integer which is either null or the number of rows affected by the operation. Here is an example <code>Execute</code> method with callback:</p>
<pre><code>    public override DataTable Execute(object state = null)
    {
        DataTable dt = new DataTable();
        ExecuteCore(cmd =&gt;
        {
            using (var reader = cmd.ExecuteReader(CommandBehavior.SequentialAccess))
            {
                dt.Load(reader);
                return dt.Rows.Count;
            }
        }, state);

        return dt;
    } 
</code></pre>

                    </div>
                    <div id="PageMaterializersmd-limitations">
                        <h4>Limitations</h4>
<p>A strict limitation on materializers is that if they open an <code>IDataReader</code> they must close it inside their callback routine. There is no facility for holding open the connection associated with the data reader.</p>

                    </div>
                </section>
                <section id="PageAppendersmd">
                    <!--<div class="page-header">
                        <h1>Appenders</h1>
                    </div>-->
                    
                    <div id="PageAppendersmd-appenders">
                        <h2>Appenders</h2>
<p>In the API, appenders are exposed as <code>ILink</code> or <code>ILink&lt;T&gt;</code> just like materializers. The difference is that while a materializer hooks onto a command builder, an appender hooks onto other links. This means you can string together as many appenders as you need to get the desired effect.</p>
<p>The mostly commonly used appenders deal with caching. You can also find appenders for tracing SQL calls, modifying command timeouts, and listening to change notification from the database (see SQL Dependency Appenders).</p>

                    </div>
                    <div id="PageAppendersmd-internals">
                        <h3>Internals</h3>
<p>Appends can be loosely grouped into these categories:</p>
<ul>
<li>Before execution</li>
<li>After execution</li>
<li>Instead of execution</li>
</ul>
<p>Appenders can fit into more than one category.</p>

                    </div>
                    <div id="PageAppendersmd-before-execution">
                        <h4>Before execution</h4>
<p>A before execution appender is usually involved with the command building process in some way. Here we see one that alters the connection timeout:</p>
<pre><code>    protected override void OnCommandBuilt(CommandBuiltEventArgs e)
    {
        if (e == null)
            throw new ArgumentNullException(&quot;e&quot;, &quot;e is null.&quot;);
        e.Command.CommandTimeout = (int)m_Timeout.TotalSeconds;
    }
</code></pre>
<p>The tracing appenders also respond to this event, but they merely read the command text instead of modifying it.</p>
<p>Another type of before execution appender is InvalidateCache, which you can see here:</p>
<pre><code>    public override void Execute(object state = null)
    {
        DataSource.InvalidateCache(m_CacheKey);

        PreviousLink.Execute(state);
    }
</code></pre>
<p>Note that the ExecuteAsync method will also have to be overridden with nearly identical logic.</p>

                    </div>
                    <div id="PageAppendersmd-after-execution">
                        <h4>After execution</h4>
<p>After execution appenders tend to work on the cache. Here is one that caches the result of an operation.</p>
<pre><code>    public override TResult Execute(object state = null)
    {
        var result = PreviousLink.Execute(state);
        DataSource.WriteToCache(new CacheItem(m_CacheKey ?? m_CacheKeyFunction(result), result, null), m_Policy);
        return result;
    }
</code></pre>

                    </div>
                    <div id="PageAppendersmd-instead-of-execution">
                        <h4>Instead of execution</h4>
<p>The quintessential instead of appender is <code>ReadOrCache</code>. As the name implies, this will read a value from the cache, and if not found executes the query and caches the resulting value. Here is an example:</p>
<pre><code>    public override TResult Execute(object state = null)
    {
        TResult result;
        if (PreviousLink.DataSource.TryReadFromCache(m_CacheKey, out result))
            return result;

        result = PreviousLink.Execute(state);

        DataSource.WriteToCache(new CacheItem(m_CacheKey, result, null), m_Policy);

        return result;
    }
</code></pre>
<p>As you can see, this appender has an effect that occurs both before and optionally after execution.</p>

                    </div>
                    <div id="PageAppendersmd-creating-an-appender">
                        <h4>Creating an Appender</h4>
<p>Using the example above and the <code>Appender</code>, <code>Appender&lt;TResult&gt;</code>, or <code>Appender&lt;Tin, TOut&gt;</code> base class, you can implement your own appender. If your appender is database specific, you may need to cast the execution into the correct subtype.</p>

                    </div>
                </section>
                <section id="PageCommandBuildersFrommd">
                    <!--<div class="page-header">
                        <h1>From Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersFrommd-from-command-builder">
                        <h2>From Command Builder</h2>
<p>This generates a SELECT statement against a table or view.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-arguments">
                        <h3>Arguments</h3>
<p>If just the table name is provided, all rows are returned.</p>
<p>If an object (model or Dictionary&lt;string, object&gt;) is provided, a WHERE clause is generated in the form of &quot;Column1 = @Value1 AND Column2 = @Value2 [...]&quot;.</p>
<p>If a filter string is provided, it is used as the where clause. Optionally, an object can be provided as parameters for the query.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-sorting">
                        <h3>Sorting</h3>
<p>To add sorting, use the <code>.WithSorting(...)</code> method. This accepts a list of strings or SortExpressions (the latter is only needed for descending sorts). To prevent SQL injection attacks, column names are validated against the database.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-limits">
                        <h3>Limits</h3>
<p>To add limits, use the <code>.WithLimits(...)</code> method. The type of limits avaialble vary from database to database. Most provide Top, Offset/Fetch, and one or more forms of random sampling.</p>
<p>Sorting is often required when using Offset/Fetch. It is not allowed when using random sampling.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-filters">
                        <h3>Filters</h3>
<p>Filters can be added (or replaced) using the <code>.WithFilter(...)</code> method. This uses the same filters (WHERE clause or filter object) that are available when calling <code>.From(...)</code>.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-limitations">
                        <h3>Limitations</h3>
<p>When using a filter string with filter parameter object, the SQL generator won't be able to determine which properties/keys are applicable. Instead, all of them will be sent to the database.</p>
<p>When using a filter string with filter parameter object, and one of the filtered columns is an ANSI string (<code>char</code>/<code>varchar</code>), you may experience performance degradation. To avoid this, pass in an array of <code>DbParameter</code> objects with the correct <code>DbParameter.DbType</code> value. (Normally DbType is inferred by checking against the column’s type.)</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If no columns are desired by the materializer, 'SELECT 1' is returned instead.</p>
<p>If soft deletes are enable for this table, the WHERE clause will filter out deleted rows.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-internals">
                        <h3>Internals</h3>
<p>All databases work the same expect for what types of limits they support.</p>

                    </div>
                    <div id="PageCommandBuildersFrommd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersByKeymd">
                    <!--<div class="page-header">
                        <h1>By Key Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersByKeymd-getbykey--updatebykey--and-deletebykey-command-builders">
                        <h2>GetByKey, UpdateByKey, and DeleteByKey Command Builders</h2>
<p>This generates a <code>SELECT</code>, <code>UPDATE</code>, or <code>DELETE</code> statement against a table using a key or list of keys.</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-arguments">
                        <h3>Arguments</h3>
<ul>
<li>The <code>…ByKey</code> variants accept one or more keys.</li>
<li>The <code>…ByKeyList</code> variants accept a list of keys.</li>
</ul>
<p>Keys must be scalar values (string, int guid, etc.)</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-arguments--updatebykey-only">
                        <h3>Arguments, <code>UpdateByKey</code> Only</h3>
<p>The <code>newValues</code> object is used to generate the <code>SET</code> clause of the <code>UDPATE</code> statement in the same manner as the normal <code>Update</code> command builder.</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-sorting">
                        <h3>Sorting</h3>
<p>Rows are returned in a non-deterministic order.</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-limitations">
                        <h3>Limitations</h3>
<p>This feature only works on tables that have a scalar primary key.</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-sql-generation">
                        <h3>SQL Generation</h3>
<p>This will generate a WHERE clause in the form of <code>PrimaryKey = @Param</code> or <code>PrimaryKey in (@Param1, @Param2, ...)</code>.</p>

                    </div>
                    <div id="PageCommandBuildersByKeymd-roadmap">
                        <h3>Roadmap</h3>
<p>Possible enhancement: use tuples to support compound primary keys. This would require an upgrade to the metadata provider, as we would need to know the exact order for the primary key.</p>

                    </div>
                </section>
                <section id="PageCommandBuildersInsertmd">
                    <!--<div class="page-header">
                        <h1>Insert Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersInsertmd-insert-command-builder">
                        <h2>Insert Command Builder</h2>
<p>The command performs an insert using the provided model.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-arguments">
                        <h3>Arguments</h3>
<p>A parameter object is used to construct the INSERT statment. If a property is marked with the IgnoreOnInsert attribute, it will not participate in this step. This attribute is usually applied to defaulted columns such as CreatedDate.</p>
<p>Alternately, a parameter dictionary of type IReadonlyDictionary&lt;string, object&gt; may be used. Again, the primary keys will be read from database metadata.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If the materializer desires columns, this echos back the newly inserted row.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-limitations">
                        <h3>Limitations</h3>
<p>This command is meant to operate on one row at a time.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-internals">
                        <h3>Internals</h3>
<p>Implementation of the insert varies by database.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-sql-server">
                        <h4>SQL Server</h4>
<p>SQL Server uses an INSERT statement with an optional OUTPUT clause.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-sqlite">
                        <h4>SQLite</h4>
<p>SQLite uses a separate INSERT and optional SELECT statement.</p>

                    </div>
                    <div id="PageCommandBuildersInsertmd-roadmap">
                        <h3>Roadmap</h3>
<p>We should create set-based insert. The biggest question is how to handle the materializer, as we may not necessarily be able to match up the returned identity values with the original objects.</p>

                    </div>
                </section>
                <section id="PageCommandBuildersUpdatemd">
                    <!--<div class="page-header">
                        <h1>Update Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersUpdatemd-update-command-builder">
                        <h2>Update Command Builder</h2>
<p>The command performs an update using the provided model.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-arguments">
                        <h3>Arguments</h3>
<p>The parameter object must contain the primary key(s) necessary to locate the record. The keys are normally read from the database, but you can override this behavior to use properties on the object that use the Key attribute.</p>
<p>The remaining properties on the parameter object are used to construct the UPDATE statment. If a property is marked with the IgnoreOnUpdate attribute, it will not participate in this step. This attribute is usually applied to columns that should never be changed such as CretedBy/CreatedDate.</p>
<p>If you use the ChangedPropertiesOnly option, only properties marked as changed by <code>IPropertyChangeTracking.ChangedProperties()</code> will be used. This interface is found in the <code>Tortuga.Anchor.ComponentModel</code> namespace.</p>
<p>Alternately, a parameter dictionary of type <code>IReadonlyDictionary&lt;string, object&gt;</code> may be used. Again, the primary keys will be read from database metadata.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If the materializer desires columns, this echos back the inserted/updated row.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-limitations">
                        <h3>Limitations</h3>
<p>This command is meant to operate on one row at a time. Set-based operations need to be performed using a SQL or Procedure command.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-internals">
                        <h3>Internals</h3>
<p>Implementation of the delete varies by database.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-sql-server">
                        <h4>SQL Server</h4>
<p>SQL Server uses an UPDATE statement with an optional OUTPUT clause.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-sqlite">
                        <h4>SQLite</h4>
<p>SQLite uses a separate UPDATE and optional SELECT statement.</p>

                    </div>
                    <div id="PageCommandBuildersUpdatemd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersUpsertmd">
                    <!--<div class="page-header">
                        <h1>Upsert Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersUpsertmd-upsert-command-builder">
                        <h2>Upsert Command Builder</h2>
<p>The command performs a insert or update using the provided model.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-arguments">
                        <h3>Arguments</h3>
<p>The parameter object must contain the primary key(s) necessary to locate the record. The keys are normally read from the database, but you can override this behavior to use properties on the object that use the Key attribute.</p>
<p>Upsert will honor the IgnoreOnInsert and IgnoreOnUpdate attributes.</p>
<p>If you use the ChangedPropertiesOnly option, only properties marked as changed by <code>IPropertyChangeTracking.ChangedProperties()</code> will be used for the insert part of the operation. This interface is found in the <code>Tortuga.Anchor.ComponentModel</code> namespace.</p>
<p>Alternately, a parameter dictionary of type IReadonlyDictionary&lt;string, object&gt; may be used. Again, the primary keys will be read from database metadata.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If the materializer desires columns, this echos back the row. The UpsertOptions flag determines if the original or new values are returned.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-limitations">
                        <h3>Limitations</h3>
<p>This command is meant to operate on one row at a time. Set-based operations need to be performed using a SQL or Procedure command.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-internals">
                        <h3>Internals</h3>
<p>Implementation of the upset varies by database.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-sql-server">
                        <h4>SQL Server</h4>
<p>Upserts are performed via a MERGE command. This command is inheritently non-atomic and may throw an exception if there is a race condition. If this occurs, the application needs to decide whether or not to retry the operation.</p>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-sqlite">
                        <h4>SQLite</h4>
<p>This requires a 3 step process:</p>
<ul>
<li>Update the existing row (if it exists)</li>
<li>Insert a new row, silently failing if it already exists</li>
<li>Select the recently inserted/updated row. (If the correct materializer was selected.)</li>
</ul>

                    </div>
                    <div id="PageCommandBuildersUpsertmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersDeletemd">
                    <!--<div class="page-header">
                        <h1>Delete Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersDeletemd-delete-command-builder">
                        <h2>Delete Command Builder</h2>
<p>The command performs a delete using the provided model.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-arguments">
                        <h3>Arguments</h3>
<p>The parameter object must contain the primary key(s) necessary to locate the record. The keys are normally read from the database, but you can override this behavior to use properties on the object that use the Key attribute.</p>
<p>Alternately, a parameter dictionary of type IReadonlyDictionary&lt;string, object&gt; may be used. Again, the primary keys will be read from database metadata.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If the materializer desires columns, this will return the row as it looked before it was deleted.</p>
<p>If soft delete is enabled for this table, an update operation will be generated to set the deleted flag.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-limitations">
                        <h3>Limitations</h3>
<p>This command is meant to operate on one row at a time. Set-based operations need to be performed using a SQL or Procedure command.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-internals">
                        <h3>Internals</h3>
<p>Implementation of the delete varies by database.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-sql-server">
                        <h4>SQL Server</h4>
<p>SQL Server uses an UPDATE statement with an optional OUTPUT clause.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-sqlite">
                        <h4>SQLite</h4>
<p>SQLite uses a separate DELETE and optional SELECT statement.</p>

                    </div>
                    <div id="PageCommandBuildersDeletemd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersSQLmd">
                    <!--<div class="page-header">
                        <h1>SQL Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersSQLmd-sql-command-builder">
                        <h2>SQL Command Builder</h2>
<p>This command executes arbitrary SQL. It makes no attempt to pre-validate said SQL.</p>

                    </div>
                    <div id="PageCommandBuildersSQLmd-arguments">
                        <h3>Arguments</h3>
<p>An optional object (model or IDictionary&lt;string, object&gt;) may be provided when executing paramterized SQL.</p>

                    </div>
                    <div id="PageCommandBuildersSQLmd-limitations">
                        <h3>Limitations</h3>
<p>When passing in paramters, the SQL generator won't be able to determine which properties/keys are applicable. Instead, all of them will be sent to the database.</p>

                    </div>
                    <div id="PageCommandBuildersSQLmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>N/A</p>

                    </div>
                    <div id="PageCommandBuildersSQLmd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageCommandBuildersSQLmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersTableFunctionmd">
                    <!--<div class="page-header">
                        <h1>Table Function Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersTableFunctionmd-table-function-command-builder">
                        <h2>Table Function Command Builder</h2>
<p>This generates a SELECT statement against a table-valued function.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-function-arguments">
                        <h3>Function Arguments</h3>
<p>Function arguments are provided as part of the <code>dataSource.TableFunction(...)</code> method. All parameters must be accounted for.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-sorting">
                        <h3>Sorting</h3>
<p>To add sorting, use the <code>.WithSorting(...)</code> method. This accepts a list of strings or SortExpressions (the latter is only needed for descending sorts). To prevent SQL injection attacks, column names are validated against the database.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-limits">
                        <h3>Limits</h3>
<p>To add limits, use the <code>.WithLimits(...)</code> method. The type of limits avaialble vary from database to database. Most provide Top, Offset/Fetch, and one or more forms of random sampling.</p>
<p>Sorting is often required when using Offset/Fetch. It is not allowed when using random sampling.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-filters">
                        <h3>Filters</h3>
<p>Filters can be added (or replaced) using the <code>.WithFilter(...)</code> method. This uses the same filters (WHERE clause or filter object) that are available when calling <code>.From(...)</code>.</p>
<p>If just the table name is provided, all rows are returned.</p>
<p>If an object (model or Dictionary&lt;string, object&gt;) is provided, a WHERE clause is generated in the form of &quot;Column1 = @Value1 AND Column2 = @Value2 [...]&quot;.</p>
<p>If a filter string is provided, it is used as the where clause. Optionally, an object can be provided as parameters for the query.</p>
<p>Do not use the same arguments for the filter expression as you use for the table parameters, as this may caused unintended behavior.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-limitations">
                        <h3>Limitations</h3>
<p>When using a filter string with filter parameter object, the SQL generator won't be able to determine which properties/keys are applicable. Instead, all of them will be sent to the database.</p>
<p>When using a filter string with filter parameter object, and one of the filtered columns is an ANSI string (<code>char</code>/<code>varchar</code>), you may experience performance degradation. To avoid this, pass in an array of <code>DbParameter</code> objects with the correct <code>DbParameter.DbType</code> value. (Normally DbType is inferred by checking against the column’s type.)</p>
<p>Some types of random sampling are not available with table-valued functions.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>If no columns are desired by the materializer, 'SELECT 1' is returned instead.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-internals">
                        <h3>Internals</h3>
<p>All databases work the same expect for what types of limits they support.</p>

                    </div>
                    <div id="PageCommandBuildersTableFunctionmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageCommandBuildersProceduremd">
                    <!--<div class="page-header">
                        <h1>Procedure Command Builder</h1>
                    </div>-->
                    
                    <div id="PageCommandBuildersProceduremd-procedure-command-builder">
                        <h2>Procedure Command Builder</h2>
<p>This command is used to execute a stored procedure that may return one or more record sets.</p>

                    </div>
                    <div id="PageCommandBuildersProceduremd-arguments">
                        <h3>Arguments</h3>
<p>If an object parameter is provided (model or IDictionary&lt;string, object&gt;), the procedure's paratmeters will be compared to those on the object. Where they match, the value will be passed in.</p>

                    </div>
                    <div id="PageCommandBuildersProceduremd-sql-generation">
                        <h3>SQL Generation</h3>

                    </div>
                    <div id="PageCommandBuildersProceduremd-sql-server">
                        <h3>SQL Server</h3>
<p>This command will use standard <code>CommandType.StoredProcedure</code> semantics.</p>

                    </div>
                    <div id="PageCommandBuildersProceduremd-postgresql">
                        <h3>PostgreSQL</h3>
<p>This command is only used for functions that return one or more <code>refcursor</code> objects.</p>
<p>This command will use standard <code>CommandType.StoredProcedure</code> semantics to get a list of cursors. Then for each cursor, <code>FETCH ALL IN &quot;cursor_name&quot;</code> will be executed.</p>

                    </div>
                    <div id="PageCommandBuildersProceduremd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageCommandBuildersProceduremd-postgresql-2">
                        <h4>PostgreSQL</h4>
<p>When building the command, <code>PostgreSqlCommandExecutionToken.DereferenceCursors</code> is set to true. This causes the data sources' execute functions to use cursor dereferencing semantics.</p>
<p>Cursors cannot be dereferenced outside of a transaction. Chain will automatically create a transacton if one doesn't exist.</p>
<p>The <code>CommandTimeout</code> is misleading, as it applied twice: once to the function call and once to the call that dereferences the cursors. This effectively doubles the amount of time that a command can theoretically take to execute.</p>

                    </div>
                    <div id="PageCommandBuildersProceduremd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageMaterializersNonQuerymd">
                    <!--<div class="page-header">
                        <h1>Non-Query Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersNonQuerymd-non-query-materializers">
                        <h2>Non-Query Materializers</h2>
<p>There are two Non-Query materializers. <code>AsNonQuery</code> has no return value, while <code>AsRowsAffected</code> returns the number of rows affected.</p>

                    </div>
                    <div id="PageMaterializersNonQuerymd-limitations">
                        <h3>Limitations</h3>
<p>The rows affected count is not necessarily accurate. For example, if a stored procedure uses <code>SET NOCOUNT ON</code> then there will be nothing to report.</p>

                    </div>
                    <div id="PageMaterializersNonQuerymd-sql-generation">
                        <h3>SQL Generation</h3>
<p>These materializers respond with NoColumns when participating in SQL generation.</p>

                    </div>
                    <div id="PageMaterializersNonQuerymd-internals">
                        <h3>Internals</h3>
<p>These materialziers use DbCommand.ExecuteNonQuery.</p>

                    </div>
                    <div id="PageMaterializersNonQuerymd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageMaterializersScalarmd">
                    <!--<div class="page-header">
                        <h1>Scalar Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersScalarmd-scalar-materializers">
                        <h2>Scalar Materializers</h2>
<p>Scalar materializers are avaialble for common .NET types such as string, numerics, date/time, etc. Nullable versions are avaialable.</p>

                    </div>
                    <div id="PageMaterializersScalarmd-options">
                        <h3>Options</h3>
<p>The scalar materializers accepts an optional column name. This may be used by the command builder when generating a SELECT clause.</p>

                    </div>
                    <div id="PageMaterializersScalarmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>As mentioned above, this materailizer may request a specific column. If no column in indicated, then AutoSelectDesiredColumns is returned to the command builder.</p>

                    </div>
                    <div id="PageMaterializersScalarmd-internals">
                        <h3>Internals</h3>
<p>All scalar materializes use DbCommand.ExecuteScalar. This means that only the first column of the first row is evaluated. Everything else is silently ignored.</p>

                    </div>
                    <div id="PageMaterializersScalarmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageMaterializersListmd">
                    <!--<div class="page-header">
                        <h1>List Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersListmd-list-materializers">
                        <h2>List Materializers</h2>
<p>List materializers are avaialble for common .NET types such as string, numerics, date/time, etc.</p>

                    </div>
                    <div id="PageMaterializersListmd-options">
                        <h3>Options</h3>
<p>The list materializers accepts an optional column name. This may be used by the command builder when generating a SELECT clause.</p>
<ul>
<li>DiscardNulls: This flag will discard null values when populating the list.</li>
<li>IgnoreExtraColumns: Normally an error is raised if multiple columns are returned. This flag will ignore them instead.</li>
<li>FlattenExtraColumns: If multiple columns are returned, this flag will cause all columns to be included in the resulting list.</li>
</ul>
<p>FlattenExtraColumns operates left to right, then top to bottom. For example:</p>
<pre><code>Resultset: 
    [1, 2, 3]
    [4, 5, 6]
List:
    1, 2, 3, 4, 5, 6
</code></pre>

                    </div>
                    <div id="PageMaterializersListmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>As mentioned above, this materailizer may request a specific column. If no column in indicated, then AutoSelectDesiredColumns is returned to the command builder.</p>

                    </div>
                    <div id="PageMaterializersListmd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageMaterializersListmd-roadmap">
                        <h3>Roadmap</h3>
<p>You can pass a  columnName  parameter to list based materializers. This parameter can be used for SQL generation, but is ignored when parsing the result set. As a result, we can't do interesting things like only read one column from a stored procedure that returns 3 columns. Task #24.</p>

                    </div>
                </section>
                <section id="PageMaterializersObjectmd">
                    <!--<div class="page-header">
                        <h1>Object/Collection Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersObjectmd-object-collection-materializers">
                        <h2>Object/Collection Materializers</h2>
<ul>
<li><code>.ToObect&lt;TObject&gt;</code></li>
<li><code>.ToCollection&lt;TObject&gt;</code></li>
<li><code>.ToCollection&lt;TObject, TCollection&gt;</code></li>
<li><code>.ToImmutableArray&lt;TObject&gt;</code></li>
<li><code>.ToImmutableList&lt;TObject&gt;</code></li>
</ul>

                    </div>
                    <div id="PageMaterializersObjectmd-options">
                        <h3>Options</h3>
<p>The <code>ToObject</code> materializer supports the <code>RowOptions</code> enumeration.
The <code>ToCollection</code> materializer supports the <code>CollectionOptions</code> enumeration.</p>
<p>The <code>ToCollection</code> materializer returns a <code>List&lt;TCollection&gt;</code> by default. You can override the collection type with any <code>ICollection&lt;TObject&gt;</code> so long as it isn’t read-only.</p>

                    </div>
                    <div id="PageMaterializersObjectmd-capabilities">
                        <h3>Capabilities</h3>
<p>Object/Collection materializers can populate non-public types.</p>
<p>Object/Collection materializers honor the Column attribute, which changes which query result set column the property is mapped to.</p>
<p>Object/Collection materializers honor the <code>NotMapped</code> attribute, which prevent the property from being mapped.</p>
<p>Object/Collection materializers honor the <code>Decompose</code> attribute. This allows properties on the child object when they match columns in the query result set.</p>
<p>If the desried object implementes <code>IChangeTracking</code>, then <code>AcceptChanges()</code> will be called automatically.</p>

                    </div>
                    <div id="PageMaterializersObjectmd-non-default-constructors">
                        <h3>Non-default Constructors</h3>
<p>If you use the <code>InferConstructor</code> option or the <code>WithConstructor</code> method, the behavior changes. Instead of setting properties, the indicated non-default constructor will be called. (With <code>InferConstructor</code>, there can only be one non-default constructor.)</p>
<p>The <code>Decompose</code> attribute doesn't apply when using a non-default constructor.</p>

                    </div>
                    <div id="PageMaterializersObjectmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>As per above, mapped properties on the object (and child properties on a decomposed property) will be requested.</p>
<p>In a non-default constructor is chosen, then SQL will only be generated for the columns that match parameter names in the constructor.</p>

                    </div>
                    <div id="PageMaterializersObjectmd-limitations">
                        <h3>Limitations</h3>
<p>Object/Collection materializers require that the <code>Decompose</code> attribute be applied correctly. The materializer needs to walk the entire object graph, and if there are any cycles represented by decomposed properties then a stack overflow exception will occur.</p>
<p>Object/Collection materializers can only populate public properties. It cannot set fields or non-public properties (unless you use a constructor).</p>

                    </div>
                    <div id="PageMaterializersObjectmd-internals">
                        <h3>Internals</h3>
<p>Object/Collection materializers use reflection to instantiate and populate the object.</p>

                    </div>
                    <div id="PageMaterializersObjectmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageMaterializersCompiledmd">
                    <!--<div class="page-header">
                        <h1>Compiled Object/Collection Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersCompiledmd-compiled-object-collection-materializers">
                        <h2>Compiled Object/Collection Materializers</h2>
<p>Compiled materializers require the <code>Tortuga.Chain.CompiledMaterializers</code> package.</p>
<ul>
<li><code>.Compiled.ToObect&lt;TObject&gt;</code></li>
<li><code>.Compiled.ToCollection&lt;TObject&gt;</code></li>
<li><code>.Compiled.ToCollection&lt;TCollection, TObject&gt;</code></li>
</ul>

                    </div>
                    <div id="PageMaterializersCompiledmd-options">
                        <h3>Options</h3>
<p>The <code>ToObject</code> materializer supports the <code>RowOptions</code> enumeration.</p>
<p>The <code>ToCollection</code> materializer returns a <code>List&lt;TCollection&gt;</code> by default. You can override the collection type with any <code>ICollection&lt;TObject&gt;</code> so long as it isn’t read-only.</p>

                    </div>
                    <div id="PageMaterializersCompiledmd-capabilities">
                        <h3>Capabilities</h3>
<p>Object/Collection materializers honor the Column attribute, which changes which query result set column the property is mapped to.</p>
<p>Object/Collection materializers honor the <code>NotMapped</code> attribute, which prevent the property from being mapped.</p>
<p>Object/Collection materializers honor the <code>Decompose</code> attribute. This allows properties on the child object when they match columns in the query result set.</p>
<p>If the desried object implementes <code>IChangeTracking</code>, then <code>AcceptChanges()</code> will be called automatically.</p>

                    </div>
                    <div id="PageMaterializersCompiledmd-sql-generation">
                        <h3>SQL Generation</h3>
<p>See Object/Collection materializers.</p>

                    </div>
                    <div id="PageMaterializersCompiledmd-limitations">
                        <h3>Limitations</h3>
<p>Object/Collection materializers require that the <code>Decompose</code> attribute be applied correctly. The materializer needs to walk the entire object graph, and if there are any cycles represented by decomposed properties then a stack overflow exception will occur.</p>
<p>Object/Collection materializers can only populate public properties. It cannot set fields or non-public properties.</p>
<p>Compiled Object/Collection materializers only support public types. Because it does not use reflection, it cannot sidestep the visibility restrictions like the non-compiled versions can.</p>
<p>Compiled Object/Collection materializers do not support generic types (other than Nullable<T>). This is not a design limitation and will be fixed in a later version. https://github.com/docevaad/Chain/issues/64</p>
<p>Compiled Object/Collection materializers do not support nested types. This is not a design limitation and will be fixed in a later version. https://github.com/docevaad/Chain/issues/63</p>
<p>Compiled Object/Collection materializers are less tolerant of column/property type mis-matches. For example, if you database column is a <code>Long</code>, you can't use a property of type <code>Nullable&lt;int&gt;</code>.</p>

                    </div>
                    <div id="PageMaterializersCompiledmd-internals">
                        <h3>Internals</h3>
<p>Compiled Object/Collection materializers use CS Script to generate the population methods.</p>

                    </div>
                    <div id="PageMaterializersCompiledmd-roadmap">
                        <h3>Roadmap</h3>
<p>Eventually we would like to support non-default constructors so that we can populate immutable objects.</p>

                    </div>
                </section>
                <section id="PageMaterializersDataTablemd">
                    <!--<div class="page-header">
                        <h1>DataRow/Table/Set Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersDataTablemd-datarow--datatable--and-dataset-materializers">
                        <h2>DataRow, DataTable, and DataSet Materializers</h2>
<p>These materializers support the legacy DataRow, DataTable, and DataSet types. They are slower than the Row, Table, and TableSet equivalents, but have the advantage of being bindable to data grids in Windows Forms and WebForms.</p>

                    </div>
                    <div id="PageMaterializersDataTablemd-options">
                        <h3>Options</h3>
<ul>
<li><code>.ToDataRow</code> supports the <code>RowOptions</code> enumeration.</li>
<li><code>.ToDataSet</code> expects a list of table names.</li>
</ul>

                    </div>
                    <div id="PageMaterializersDataTablemd-sql-generation">
                        <h3>SQL Generation</h3>
<p>These materializers do not request any columns. See the associated command builder for the behavior.</p>

                    </div>
                </section>
                <section id="PageMaterializersTablemd">
                    <!--<div class="page-header">
                        <h1>Row, Table, and TableSet Materializers</h1>
                    </div>-->
                    
                    <div id="PageMaterializersTablemd-row--table--and-tableset-materializers">
                        <h2>Row, Table, and TableSet Materializers</h2>
<p>These are modern equivalents to DataRow, DataTable, and DataSet.</p>

                    </div>
                    <div id="PageMaterializersTablemd-options">
                        <h3>Options</h3>
<ul>
<li><code>.ToRow</code> supports the <code>RowOptions</code> enumeration.</li>
<li><code>.ToTableSet</code> expects a list of table names.</li>
</ul>

                    </div>
                    <div id="PageMaterializersTablemd-sql-generation">
                        <h3>SQL Generation</h3>
<p>These materializers do not request any columns. See the associated command builder for the behavior.</p>

                    </div>
                    <div id="PageMaterializersTablemd-internals">
                        <h3>Internals</h3>
<p>A Row is implemented as an immutable dictionary. Likewise, Table and TableSet are immutable.</p>

                    </div>
                    <div id="PageMaterializersTablemd-roadmap">
                        <h3>Roadmap</h3>
<p>These objects, while faster than the legacy versions, can probably be improved even more if we switch to an array based internal implementation. We’re looking for improvements both in performance and, more importantly, memory consumption.</p>

                    </div>
                </section>
                <section id="PageAppendersCachingmd">
                    <!--<div class="page-header">
                        <h1>Caching Appenders</h1>
                    </div>-->
                    
                    <div id="PageAppendersCachingmd-caching-appenders">
                        <h2>Caching Appenders</h2>
<ul>
<li><code>.Cache(...)</code></li>
<li><code>.CacheAllItems(...)</code></li>
<li><code>.InvalidateCache(...)</code></li>
<li><code>.ReadOrCache(...)</code></li>
</ul>

                    </div>
                    <div id="PageAppendersCachingmd-cache-keys">
                        <h3>Cache Keys</h3>
<p>Cache keys can be provided as a string or a function. In the latter case, the function accepts the result of the chain and returns a string.</p>
<p><code>.CacheAllItems(...)</code> is a special case. It only operates on lists of objects and generates a cache key for each object seperately.</p>

                    </div>
                    <div id="PageAppendersCachingmd-example-of-a-caching-repository">
                        <h3>Example of a Caching Repository</h3>
<p>In this example you can see the interplay between caching individual records and caching collections using <code>CacheAllItems</code>.</p>
<pre><code>public class EmployeeCachingRepository
{

    private const string TableName = &quot;HR.Employee&quot;;
    private const string AllCacheKey = &quot;HR.Employee ALL&quot;;

    public IClass1DataSource Source { get; private set; }
    public CachePolicy Policy { get; private set; }

    public EmployeeCachingRepository(IClass1DataSource source, CachePolicy policy = null)
    {
        Source = source;
        Policy = policy;
    }

    protected string CacheKey(int id)
    {
        return $&quot;HR.Employee EmployeeKey={id}&quot;;
    }

    protected string CacheKey(Employee entity)
    {
        return CacheKey(entity.EmployeeKey.Value);
    }

    public Employee Get(int id)
    {
        return Source.GetByKey(TableName, id).ToObject&lt;Employee&gt;().ReadOrCache(CacheKey(id), policy: Policy).Execute();
    }

    public IList&lt;Employee&gt; GetAll()
    {
        return Source.From(TableName).ToCollection&lt;Employee&gt;().CacheAllItems((Employee x) =&gt; CacheKey(x), policy: Policy).ReadOrCache(AllCacheKey, policy: Policy).Execute();
    }

    public Employee Insert(Employee entity)
    {
        return Source.Insert(TableName, entity).ToObject&lt;Employee&gt;().InvalidateCache(AllCacheKey).Cache((Employee x) =&gt; CacheKey(x), policy: Policy).Execute();
    }

    public Employee Update(Employee entity)
    {
        return Source.Update(TableName, entity).ToObject&lt;Employee&gt;().Cache(CacheKey(entity)).InvalidateCache(AllCacheKey).Execute();
    }

    public void Delete(int id)
    {
        Source.DeleteByKey(TableName, id).InvalidateCache(CacheKey(id)).InvalidateCache(AllCacheKey).Execute();
    }
}
</code></pre>

                    </div>
                    <div id="PageAppendersCachingmd-internals">
                        <h3>Internals</h3>
<p>The caching appenders use the data source to access a cache. Currently that data source is hard-coded to use .NET's built-in <code>MemoryCache</code>.</p>

                    </div>
                    <div id="PageAppendersCachingmd-roadmap">
                        <h3>Roadmap</h3>
<p>The current plan is to allow the caching framework to be swapped out.</p>

                    </div>
                </section>
                <section id="PageAppendersTracingmd">
                    <!--<div class="page-header">
                        <h1>Tracing Appenders</h1>
                    </div>-->
                    
                    <div id="PageAppendersTracingmd-tracing-appenders">
                        <h2>Tracing Appenders</h2>
<p>The tracing appenders are usually used for debugging purposes. For logging, the events on DataSource are more useful.</p>
<ul>
<li><code>.WithTracing</code></li>
<li><code>.WithTracingToDebug</code></li>
<li><code>.WithTracingToConsole</code></li>
</ul>

                    </div>
                    <div id="PageAppendersTracingmd-arguments">
                        <h3>Arguments</h3>
<p>The generic <code>.WithTracing</code> appender accepts a <code>TextWriter</code>, while the others</p>

                    </div>
                    <div id="PageAppendersTracingmd-internals">
                        <h3>Internals</h3>
<p>These appenders listen for the OnCommandBuilt event.</p>

                    </div>
                    <div id="PageAppendersTracingmd-roadmap">
                        <h3>Roadmap</h3>

                    </div>
                </section>
                <section id="PageAppendersSqlDependencymd">
                    <!--<div class="page-header">
                        <h1>Change Notification Appenders</h1>
                    </div>-->
                    
                    <div id="PageAppendersSqlDependencymd-change-notification-appenders">
                        <h2>Change Notification Appenders</h2>
<p><strong>SQL Server Only</strong></p>
<p>The <code>WithChangeNotification</code> appender is implemented on top of SQL Dependency. It is essential that you read and understand the requirements for using SQL Dependency before attempting to use this appender.</p>
<p>https://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldependency.aspx</p>

                    </div>
                    <div id="PageAppendersSqlDependencymd-arguments">
                        <h3>Arguments</h3>
<p>This appender accepts an <code>OnChangeEventHandler</code> delegate, which will be fired one time if the database detects an associated change. Once it fires, the event will have to be reattached.</p>

                    </div>
                    <div id="PageAppendersSqlDependencymd-internals">
                        <h3>Internals</h3>

                    </div>
                    <div id="PageAppendersSqlDependencymd-roadmap">
                        <h3>Roadmap</h3>
<p>Automatic cache invalidation is planned for the future. https://github.com/docevaad/Chain/issues/23</p>

                    </div>
                </section>
                <section id="PageAuditRulesmd">
                    <!--<div class="page-header">
                        <h1>Audit Rules</h1>
                    </div>-->
                    
                    <div id="PageAuditRulesmd-audit-rules">
                        <h2>Audit Rules</h2>
<p>Audit rules allow you to drastically reduce the amount of boilerplate code needed for common scenarios such as verifying a record is valid before saving it, setting the created by or updated by column, and honoring soft deletes.</p>
<p>Note that all of these rules are applied at the data source level. You cannot selectively apply them to individual tables, though you can use multiple data sources with different rules.</p>

                    </div>
                    <div id="PageAuditRulesmd-validation">
                        <h3>Validation</h3>
<p>Chain supports the following validation interfaces:</p>
<ul>
<li><code>IDataErrorInfo</code></li>
<li><code>INotifyDataErrorInfo</code></li>
<li><code>IValidatable</code> (From Tortuga Anchor)</li>
</ul>
<p>Validation will only occur if the object used for the insert/update operation implements the indicated interface.</p>
<p>Example:</p>
<pre><code>dataSource = dataSource.WithRules(new ValidateWithDataErrorInfo (OperationType.InsertOrUpdate));
</code></pre>

                    </div>
                    <div id="PageAuditRulesmd-triggering-validation">
                        <h4>Triggering Validation</h4>
<p>Depending on your object model, you may need to manually trigger validation before IDataErrorInfo or INotifyDataErrorInfo report an error condition.</p>
<pre><code>dataSource = dataSource.WithRules(new ValidateWithDataErrorInfo&lt;ModelBase&gt;(OperationType.InsertOrUpdate, x =&gt; x.Validate()));
</code></pre>

                    </div>
                    <div id="PageAuditRulesmd-custom-validation">
                        <h4>Custom Validation</h4>
<p>If your object model has its own validation interface, you can subclass <code>ValidationRule</code>.</p>

                    </div>
                    <div id="PageAuditRulesmd-created-by-updated-by-support">
                        <h3>Created By/Updated By Support</h3>
<p>Chain can automatically set fields such as “CreatedByKey” and “UpdatedByKey”. There are two steps necessary to do this. First, you need to create a data source with the appropriate rules. As with a normal data source, this should be cached at the application level.</p>
<pre><code>dataSource = dataSource.WithRules(
    new UserDataRule(&quot;CreatedByKey&quot;, &quot;UserKey&quot;, OperationType.Insert),
    new UserDataRule(&quot;UpdatedByKey&quot;, &quot;UserKey&quot;, OperationType.InsertOrUpdate));
</code></pre>
<p>When a request is initiated, you then create a contextual data source with the user object. There are no restrictions on what this object looks like, so long as it has the columns indicated by your audit rules.</p>
<pre><code>myDS = dataSource.WithUser(currentUser);
</code></pre>
<p>When using the contextual data source, the indicated rules will be automatically applied to insert, and update operations. For example:</p>
<pre><code>myDS.Update(&quot;Customer&quot;, customer).Execute();
</code></pre>
<p>This will automatically apply the user’s <code>UserKey</code> value to the <code>UpdatedByKey</code> column when performing the update operation. This replaces any value on <code>customer.UpdatedByKey</code> and will work even if <code>customer.UpdatedByKey</code> is marked as <code>[IgnoreOnUpdate]</code>.</p>

                    </div>
                    <div id="PageAuditRulesmd-created-date-updated-date-support">
                        <h3>Created Date/Updated Date Support</h3>
<p>To ensure that <code>CreatedDate</code> and <code>UpdatedDate</code> are correctly set without using constraints and triggers, you can use <code>DateTimeRule</code> or <code>DateTimeOffsetRule</code>.</p>
<pre><code>dataSource = dataSource.WithRules(
    new DateTimeRule(&quot;CreatedDate&quot;, DateTimeKind.Local, OperationType.Insert),
    new DateTimeRule(&quot;UpdatedDate&quot;, DateTimeKind.Local, OperationType.InsertOrUpdate));
</code></pre>
<p>These rules do not require a context data source.</p>

                    </div>
                    <div id="PageAuditRulesmd-soft-delete-support">
                        <h3>Soft Delete Support</h3>
<p>Soft delete support is enabled by add a<code>SoftDeleteRule</code>. This rule can apply to delete and/or select operations. Usually the <code>SoftDeleteRule</code> will be combined for rules that set a deleted by and/or deleted date column. For example:</p>
<pre><code>dataSource = dataSource.WithRules(
    new SoftDeleteRule(&quot;DeletedFlag&quot;, 1, OperationType.SelectOrDelete),
    new UserDataRule(&quot;DeletedByKey&quot;, &quot;UserKey&quot;, OperationType.Delete),
    new DateTimeOffsetRule(&quot;DeletedDate&quot;, OperationType.Delete));
</code></pre>
<p>When soft deletes are in effect, calling <code>dataSource.Delete</code> will automatically switch from a hard to a soft delete if the correct column exists.</p>
<p>Likewise, the <code>dataSource.From</code> operation will automatically rewrite the WHERE clause to filter out deleted records.</p>

                    </div>
                    <div id="PageAuditRulesmd-transactions">
                        <h3>Transactions</h3>
<p>A transactional data source inherits the rules and user value from the data source used to create it. If necessary, you can chain these operations together. For example:</p>
<pre><code>using (var trans = dataSource.WithUser(currentUser).BeginTransaction())
</code></pre>

                    </div>
                    <div id="PageAuditRulesmd-dependency-injection">
                        <h3>Dependency Injection</h3>
<p>If your DI framework supports it, you should create the contextual data source using the <code>dataSource.WithUser</code> function at the beginning of the request. You can then inject that data source instead of the application-wide version to ensure that audit rules are enforced.</p>

                    </div>
                </section>
                <section id="PageRestrictedColumnsmd">
                    <!--<div class="page-header">
                        <h1>Restricted Columns</h1>
                    </div>-->
                    
                    <div id="PageRestrictedColumnsmd-restricted-columns">
                        <h2>Restricted Columns</h2>
<p>Chain’s restricted column support allows you to limit read/write access to particular columns based on the user. These restrictions can be applied globally or to specific tables.</p>
<p>You setup a restricted column the same way you would any other audit rule. Here is an example that prevents users from granting themselves admin privileges:</p>
<pre><code class="language-csharp">ExceptWhenPredicate IsAdminCheck = user =&gt; ((UserToken)user).IsAdmin;

DataSource = DataSource.WithRules(new RestrictColumn(&quot;Users&quot;, &quot;IsAdmin&quot;, OperationTypes.Insert |  OperationTypes.Update, IsAdminCheck));
</code></pre>
<p>Whenever an operation is performed against the <code>Users</code> table, the <code>IsAdminCheck</code> function will be executed. If the check fails, the SQL generator will skip the IsAdmin column while performing insert/update operations.</p>
<p>There are cases where you may need to universally block access to a column. For example, say you find that the CreditCardNumber is being exposed via multiple tables and views. While you still want your payment resolution managers to have access to it, most users shouldn’t see it. We can enable using this syntax:</p>
<pre><code class="language-csharp">ExceptWhenPredicate IsManger = user =&gt; ((UserToken)user).HasRoles(&quot;PaymentResolutionManager&quot;);

DataSource = DataSource.WithRules(new RestrictColumn(&quot;CreditCardNumber&quot;, OperationTypes.Select, IsManger));
</code></pre>
<p>An interesting effect of this rule is that it only blocks reads, not writes. So non-managers can update a customer’s credit card number even though they can’t actually see it themselves after pressing the save button.</p>

                    </div>
                    <div id="PageRestrictedColumnsmd-usage-notes">
                        <h3>Usage Notes</h3>
<p>Once you setup a restricted column rule, you need to ensure that all data access is performed within the context of a user. For example:</p>
<pre><code class="language-csharp">var ds = DataSource.WithUser(currentUser);
//perform operations with ds    
</code></pre>
<p>This can be combined with a transaction:</p>
<pre><code class="language-csharp">using (var ds = DataSource.WithUser(currentUser).BeginTransaction())
{
    //perform operations with ds    
    ds.Commit();
}
</code></pre>

                    </div>
                    <div id="PageRestrictedColumnsmd-implementation">
                        <h3>Implementation</h3>
<p>Restricted columns are built on top of the Audit Rules functionality and participate in the SQL generation process. This means that it is possible to bypass the restriction using stored procedures.</p>
<p>Audit rules and restricted columns are not intended to be mixed. For example, if you have an audit rule for setting the UpdatedBy/LastUpdatedDate columns, do not put a restricted column rule on the same columns.</p>

                    </div>
                </section>
                <section id="PageTransactionsmd">
                    <!--<div class="page-header">
                        <h1>Transactions</h1>
                    </div>-->
                    
                    <div id="PageTransactionsmd-transactions">
                        <h2>Transactions</h2>
<p>Basic transactions are created by calling <code>dataSource.BeginTransaction()</code>. This creates a transactional data source which can then be used just like a normal database.</p>
<p>Transactional data sources contain an open connection and transaction object, so they should be managed with a <code>using</code> statement just like any other limited resource.</p>
<pre><code class="language-csharp">using (var trans = dataSource.BeginTransaction())
{
    var newKey = trans.Insert(&quot;Customer&quot;, customer).AsInt32().Execute();
    address.CustomerKey = newKey;
    trans.Insert(&quot;CustomerAddress&quot;, address).Execute();
    trans.Commit();
}
</code></pre>

                    </div>
                    <div id="PageTransactionsmd-attaching-to-active-connections-and-transactions">
                        <h3>Attaching to Active Connections and Transactions</h3>
<p>There may be times when you need to attach a data source to an existing connection or transaction. This usually happens when mixing Chain with another ORM.</p>
<p>To do this, simply call <code>CreateOpenDataSource</code> on a normal data source and pass in the connection object. Optionally, you can also include a transaction object.</p>
<pre><code class="language-csharp">var openDataSource = dataSource.CreateOpenDataSource( activeConnection, activeTransaction);
</code></pre>
<p>An open data source does not &quot;own&quot; the connection or transaction associated with it. This means that the open data source cannot close the connection or commit the transaction itself.</p>

                    </div>
                </section>
                <section id="PageOtherEntityFrameworkmd">
                    <!--<div class="page-header">
                        <h1>Entity Framework Integration</h1>
                    </div>-->
                    
                    <div id="PageOtherEntityFrameworkmd-entity-framework-integration">
                        <h2>Entity Framework Integration</h2>
<p>Chain can be combined with Entity Framework (EF) using the <code>ChainForEntityFramework</code> extension.</p>
<p>To use <code>ChainForEntityFramework</code>, first include the code at the botom of this page in your project.</p>
<p>You'll need to register a Chain data source with a DBConext. Or more accurately, you are registering the DBConext's connection string. Normally you would do this at startup using a DBConext that you then discard.</p>
<p>Once you have done that, you may invoke Chain methods from the DBConext as shown.</p>
<pre><code>DBConext context = [...]
context.Chain().From(...)
</code></pre>
<p>If your <code>DBConext</code> is currently participating in a transaction, any operations that Chain performs will also particpate in the transaction.</p>
<p>Do not cache the results of <code>DBConext.Chain</code>. The context will occasionally close the connection and calling <code>.Chain()</code> will reopen it if necessary.</p>

                    </div>
                    <div id="PageOtherEntityFrameworkmd-chainforentityframework-class">
                        <h3>ChainForEntityFramework Class</h3>
<pre><code class="language-csharp">    public static class ChainForEntityFramework
    {
        static ConcurrentDictionary&lt;string, IRootDataSource&gt; s_DataSources = new ConcurrentDictionary&lt;string, IRootDataSource&gt;();

        /// &lt;summary&gt;
        /// Registers the data source.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;context&quot;&gt;An example context. Really the connection string is what's being registered.&lt;/param&gt;
        /// &lt;param name=&quot;dataSource&quot;&gt;The data source.&lt;/param&gt;
        public static void RegisterDataSource&lt;T&gt;(this DbContext context, T dataSource) where T : IRootDataSource, IClass2DataSource
        {
            s_DataSources[context.Database.Connection.ConnectionString] = dataSource;
        }

        /// &lt;summary&gt;
        /// Registers the data source.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;context&quot;&gt;An example context. Really the connection string is what's being registered.&lt;/param&gt;
        /// &lt;param name=&quot;dataSourceFactory&quot;&gt;The data source factory.&lt;/param&gt;
        public static void RegisterDataSource&lt;T&gt;(this DbContext context, Func&lt;string, T&gt; dataSourceFactory) where T : IRootDataSource, IClass2DataSource
        {
            s_DataSources[context.Database.Connection.ConnectionString] = dataSourceFactory(context.Database.Connection.ConnectionString);
        }

        public static IClass2DataSource Chain(this DbContext context)
        {
            var connection = context.Database.Connection;
            var transaction = context.Database.CurrentTransaction?.UnderlyingTransaction;

            //If context.SaveChanges is called, the connection will be immediately closed.
            if (connection.State == ConnectionState.Closed)
                connection.Open();

            return (IClass2DataSource)s_DataSources[context.Database.Connection.ConnectionString].CreateOpenDataSource(connection, transaction);
        }

    }
</code></pre>

                    </div>
                </section>
                <section id="PageOtherNHibernatemd">
                    <!--<div class="page-header">
                        <h1>NHibernate Integration</h1>
                    </div>-->
                    
                    <div id="PageOtherNHibernatemd-nhibernate-integration">
                        <h2>NHibernate Integration</h2>
<p>Chain can be combined with NHibernate using the <code>ChainForNHibernate</code> extension.</p>
<p>To use <code>ChainForNHibernate</code>, first include the code at the botom of this page in your project.</p>
<p>You'll need to register a Chain data source for each ISessionFactory. Or more accurately, you are registering the ISessionFactory's connection string. Normally you would do this at startup just after creating the ISessionFactory itself.</p>
<p>Once you have done that, you may invoke Chain methods from the ISession as shown.</p>
<pre><code>ISesion session = [...]
session.Chain().From(...)
</code></pre>
<p>If your <code>ISession</code> is currently participating in a transaction, any operations that Chain performs will also particpate in the transaction.</p>
<p>You may wish to call <code>ISession.Flush()</code> before invoking Chain commands if the order of operations is important. Chain will not implicitly call <code>Flush</code> for you.</p>
<p>You can improve memory usage slighly by caching the results of <code>ISession.Chain</code> for the lifetime of the ISession object. The difference should be minimal, as most of the internal state such as the metadata cache is shared with the root data source that you registered with the <code>ISessionFactory</code>.</p>

                    </div>
                    <div id="PageOtherNHibernatemd-chainfornhibernate-class">
                        <h3>ChainForNHibernate Class</h3>
<pre><code class="language-csharp">    public static class ChainForNHibernate
    {
        static ConcurrentDictionary&lt;string, IRootDataSource&gt; s_DataSources = new ConcurrentDictionary&lt;string, IRootDataSource&gt;();

        public static void RegisterDataSource&lt;T&gt;(this ISessionFactory sessionFactory, T dataSource) where T : IRootDataSource, IClass2DataSource
        {
            using (var session = sessionFactory.OpenSession())
            {
                s_DataSources[session.Connection.ConnectionString] = dataSource;
            }
        }

        /// &lt;summary&gt;
        /// Registers the data source.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;sessionFactory&quot;&gt;The session factory. The input parameter is a connection string extracted from the session factory.&lt;/param&gt;
        /// &lt;param name=&quot;dataSourceFactory&quot;&gt;The data source factory.&lt;/param&gt;
        public static void RegisterDataSource&lt;T&gt;(this ISessionFactory sessionFactory, Func&lt;string, T&gt; dataSourceFactory) where T : IRootDataSource, IClass2DataSource
        {
            using (var session = sessionFactory.OpenSession())
            {
                s_DataSources[session.Connection.ConnectionString] = dataSourceFactory(session.Connection.ConnectionString);
            }
        }

        public static IClass2DataSource Chain(this ISession session)
        {

            //These casts won't be necessary with Chain Version 1.1.
            DbConnection connection = (DbConnection)session.Connection;
            DbTransaction transaction = (DbTransaction)GetTransaction(session);

            return (IClass2DataSource)s_DataSources[session.Connection.ConnectionString].CreateOpenDataSource(connection, transaction);
        }

        //http://ayende.com/blog/1583/i-hate-this-code

        private static IDbTransaction GetTransaction(ISession session)

        {
            using (var command = session.Connection.CreateCommand())
            {
                session.Transaction.Enlist(command);
                return command.Transaction;
            }
        }

    }
</code></pre>

                    </div>
                </section>
            </div>
        </div>
    </div>
    <script src="Scripts/jquery-2.2.3.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/projbook.js"></script>
</body>
</html>
